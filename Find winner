
competitionGT=function(players, path){
k=1

maxFiles=2000
filenames=vector()
filenames[1]=paste(path, "/report.csv", sep="")
for(i in 1:maxFiles) filenames[i+1]=paste(path, "/report(", i, ").csv", sep="")

scoreBoard=as.data.frame(matrix(NA, 0, 3))
colnames(scoreBoard)=c("Round", "Player", "Score")

#File selector k
k=length(list.files(path))+1

#Set initial value for round winner
roundWinner=as.character(players[1,1])

#Start competition
for(i in seq(2, nrow(players), by=4)){

#roundWinner always participates in the competition
query=roundWinner

#Select batch of four players to go up against the roundWinner. The min function ensures that there are no empty slots
batch=players[i:min((i+3),nrow(players)),1]

#Create Google Trends query, download and import file
for(j in 1:length(batch)) query=paste(query, "%2C ", batch[j], sep="")
URL=paste("http://www.google.com/trends/trendsReport?hl=en-US&q=", query,"&cmpt=q&content=1&export=1", sep="")
browseURL(URL)
Sys.sleep(5)

players.raw=read.csv(filenames[k], header=FALSE, blank.lines.skip=FALSE, stringsAsFactors=FALSE)

#Initialize results
results=data.frame(matrix(NA, (nrow=length(players.raw)-1), ncol=3))
results[,1]=k
for(i in 1:(ncol(players.raw)-1)) results[i,2]=players.raw[5,i+1]
for(i in 1:(ncol(players.raw)-1)) results[i,3]=as.numeric(as.character(players.raw[(which(players.raw=="")[2]-2),i+1]))

highScore=max(results[,3])

colnames(results)=c("Round", "Player", "Score")

roundWinner=results[which(results[,3]==highScore),2]
scoreBoard=rbind(scoreBoard, results)

k=k+1 #Move file selector one step forward
}

winner=data.frame("Winner", roundWinner, highScore)
colnames(winner)=c("Round", "Player", "Score")
scoreBoard=rbind(scoreBoard, winner)

return(scoreBoard)
}

setwd("C:/Users/erik.johansson/Dropbox/Google Trends")
path.capitals="Capitals/GT data"
path.capitals2="Capitals/European capitals.csv"

path.brands="Top 10 brands/Data"
path.brands2="Top 10 brands/500 most valuable.csv"

players=read.csv(path.brands2, sep=";")
podiumSize=10
round=list()
for(i in 1:podiumSize){
round[[i]]=competitionGT(players, path)
players=players[-which(tolower(players[,1])==
round[[i]][nrow(round[[i]]),2]),]
}

scoreBoard=data.frame(1:10)
for(i in 1:podiumSize) scoreBoard[i,2]=round[[i]][which(round[[i]][,1]=="Winner"),2]
colnames(scoreBoard)=c("Rank", "Capital")
